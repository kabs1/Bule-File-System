name: Deploy to FTPS

on:
  workflow_dispatch:
    inputs:
      deployment_id:
        description: 'Deployment ID (e.g., a version number or specific tag)'
        required: false
        type: string
        default: 'latest'

jobs:
  deploy:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Setup Node.js (if needed for build)
        uses: actions/setup-node@v4
        with:
          node-version: '18' # Adjust if your project requires a different Node.js version

      - name: Install dependencies (if needed for build)
        run: npm install # Or yarn install, composer install, etc.

      - name: Build project (if needed)
        run: npm run build # Or yarn build, php artisan optimize, etc.

      - name: Deploy to FTPS
        uses: SamKirkland/FTP-Deploy-Action@v4.3.0
        with:
          server: ${{ secrets.FTP_SERVER }}
          username: ${{ secrets.FTP_USERNAME }}
          password: ${{ secrets.FTP_PASSWORD }}
          port: 21 # Common FTPS port, adjust if different (e.g., 990 for implicit FTPS)
          protocol: ftps # Use 'ftps' for FTPS, 'ftp' for FTP
          local-dir: './' # The local directory to deploy from (e.g., './public' for Laravel)
          remote-directory: '/' # The remote directory on your FTPS server
          # For incremental deployment, you might need to manage a .ftp_deploy_sync_state file
          # or use a different action that supports diffing.
          # This action by default only uploads changed files if a .ftp_deploy_sync_state file exists.
          # To force a full deployment, you can delete the .ftp_deploy_sync_state file before this step.
